# アーキテクチャ決定記録：ナビゲーション検出とARIAツリー

## 現状の問題

1. **抽象化レベルの不一致**
   - ARIAツリーは抽象化されたアクセシビリティ情報
   - ナビゲーション検出には具体的なDOM情報（クラス名、ID等）が必要

2. **前処理による情報の喪失**
   - `extractAriaTree`は前処理を含むため、ナビゲーション要素が削除される
   - ナビゲーション検出には前処理前の状態が必要

3. **圧縮処理による構造の破壊**
   - `compressAriaTree`が階層構造を平坦化
   - ヘッダーやナビゲーションの検出に必要な構造が失われる

## 設計選択肢

### 選択肢1: 検出専用のツリー構築
- 前処理を行わない専用のツリー構築関数を作成
- 検出に必要な全ての情報を保持

### 選択肢2: AriaNodeの拡張
- AriaNodeに検出用の追加情報を持たせる
- originalElementへの参照を常に保持

### 選択肢3: 二段階処理
- 検出フェーズ：前処理前のDOMで実行
- 抽出フェーズ：前処理後のDOMで実行

## 決定

**選択肢3: 二段階処理** を採用する。

理由：
1. 責任の分離が明確
2. 既存のコードへの影響が最小限
3. 各フェーズで最適な処理が可能

## 実装方針

1. `analyzePageStructure`は前処理前のDOMを使用
2. ヘッダー・ナビゲーション検出は圧縮前のARIAツリーを使用
3. コンテンツ抽出は既存の前処理済みロジックを使用

これにより、各コンポーネントが適切な抽象化レベルで動作できる。